# CI/CD

## Terminology

1. Continuous integration - code changes are validated and merged back into main branch as often as possible
2. Continuous delivery - code changes are automatically built and ready for production
3. Continuous deployment - Builds are automatically deployed to production environment
4. Cron - Executes commands on schedule
5. Show location of bash - `which bash`
6. Show all cronjobs - `crontab -e`
7. [crontab guru](https://crontab.guru/)
8. View system processes (includes cronjob) - `sudo cat /var/log/syslog`
9. Allow any error messages generated by a command to be combined with its standard output and sent to the same destination, such as the terminal or a file - [2>&1](https://stackabuse.com/what-does-2-1-do-on-the-command-line/)
10. Run the last command as sudo - `sudo !!`

[CI / CD diagram](https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment)

## [Spinnaker](https://spinnaker.io/)

CI / CD for enterprise companies

## Bash script 

```
#! <location of bash - typically /usr/bin/bash>

<commands to run>
```

```
#! /usr/bin/bash

cd /var/www/app/
git pull origin main --ff-only
```

## Cron

Cron will run from root so be sure to `cd` to a directory if needed.

| minute | hour | day (month) | month | day (week) | use bash | path to execute |
| ------ | ---- | ----------- | ----- | ---------- | -------- | --------- | 
|   *    |   *  |      *      |   *   |      *     |    sh    |   ../../

In crontab

Run github script every minute and pipe into syslog (logger)
```
* * * * * sh /var/www/app/github.sh 2>&1 | logger -t github.sh
```

## Logs

They are outputted in `/var/log/`

* syslog
* auth.log
* nginx/access.log

### Ways of outputting

1. Last part of file - `tail -f`
2. First part of file - `head`
3. One page at a time - `less`
4. Entire file - `cat`

## Standard streams

Posix standard - portable operating system interface for unix. Every command has an input (stdin), output (stdout), and error (stderr). So all commands have the same function signature

* Standard output - `stdout`
* Standard input - `stdin`
* Standard error - `stderr`

### Redirection

* Read from stdout - `|`
* Write stdout to file - `>`
* Append stdout to file - `>>`
* Read from stdin - `<`
* Redirect both stderr and stdout - `2>&1`

## Finding / Manipulating things

1. Search file names / directories - `find`
2. Search file contents - `grep`
3. Manipulate file contents - [awk](https://www.youtube.com/watch?v=FbSpuZVb164&list=LL&index=10)
4. String replacements - [sed](https://www.youtube.com/watch?v=w61mxJcUV-o)

[14 Linux Data Science Commands In 14 Minutes](https://www.youtube.com/watch?v=hRiencURwn0)

### Find command

`find <directory> <options> <file/directory>`

1. Find all log files in /var/log - `find /var/log -type f -name "*.log"`
2. Find all directories with the name 'log' - `find / -type d -name log`

### Grep command

`grep <options> <search_text> <directory>`

1. Search inside gzip file - `zgrep <file>`
2. Find running node processes - `ps aux | grep node`

## Nginx

### Redirect

```
location /help {
  return 301 https://developer.mozilla.org/en-US/;
}
```

### Gzip

`/etc/nginx/nginx.conf`

```
gzip on;
```

* jpg, png, mp3 are all examples of compression algorithms

### Subdomains

To create a subdomain:
1. Create an A record
2. Create a server on nginx

`sudo vi /etc/nginx/sites-enabled/my-subdomain-name`

```
server {
  listen 80;
  listen [::]:80; # This is for ipv6
  server_name <your_subdomain>.<your_domain>

  location / {
    proxy_pass http://localhost:3000;
  }
}
```

3. Update nginx.conf

`sudo vi /etc/nginx/nginx.conf`

```
##
# Virtual host configs
##

include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/<your-domain>
include /etc/nginx/sites-enabled/<your-sub-domain>
```

4. Validate then restart nginx

`sudo nginx -t`
`sudo service nginx restart`